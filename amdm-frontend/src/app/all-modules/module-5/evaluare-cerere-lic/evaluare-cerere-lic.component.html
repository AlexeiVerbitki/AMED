<div class="container-fluid sky z-depth-2">
    <h3 class="text-center my-3 font-weight-bold">Evaluarea cererii de licentiere</h3>
    <hr>

    <div class="text-center">
        <div class="container">
            <h5 class="text-center font-weight-bold" *ngIf="tipCerere === 'LICEL'">Eliberarea licentei</h5>
            <h5 class="text-center font-weight-bold" *ngIf="tipCerere === 'LICM'">Modificarea licentei</h5>
            <h5 class="text-center font-weight-bold" *ngIf="tipCerere === 'LICD'">Eliberarea duplicatului</h5>
        </div>
    </div>
    <form [formGroup]="mForm">
        <hr>
        <div class="row">
            <div class="col-md-6">
                <div class="md-form">
                    <input id="nrCererii" mdbInputDirective type="text" class="form-control"
                           formControlName="nrCererii">
                    <label for="nrCererii">Nr. cererii</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="md-form-modified">
                    <mat-form-field class="w-100">
                        <input matInput [matDatepicker]="picker2" placeholder="Data adresarii" id="dataEliberarii"
                               formControlName="dataEliberarii">
                        <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                        <mat-datepicker touchUi #picker2></mat-datepicker>
                    </mat-form-field>
                </div>
            </div>
        </div>


        <app-document [documents]="docs" [nrCerere]="mForm.get('nrCererii').value" (documentModified)="documentAdded($event)"></app-document>
        <div *ngIf="rFormSubbmitted && docs.length==0">
            <small class="text-muted"><strong class="text-danger">Nici un document nu a fost incarcat</strong></small>
        </div>

    </form>

    <form [formGroup]="rForm">
        <section *ngIf="tipCerere">
            <hr>
            <h5 class="text-center font-weight-bold">Detalii personal</h5>
            <hr>

            <div class="row">
                <div class="col-md-3">
                    <div class="md-form-modified-select">
                        <ng-select class="custom" [items]="farmacisti"
                                   [addTag]="addTagPromise"
                                   bindLabel="fullName"
                                   placeholder="Farmacist diriginte"
                                   formControlName="farmDir"
                                   [required]="true"
                                   [hideSelected]="true"

                        >
                            <ng-template ng-tag-tmp let-search="searchTerm">
                                <b>Adauga farmacist diriginte</b>: {{search}}
                            </ng-template>
                            <ng-template ng-option-tmp let-item="item">
                                <div>{{item.fullName}}</div>
                                <small class="form-text text-muted">{{item.selectionDate| date: 'dd/MM/yyyy
                                    HH:mm:ss'}}
                                </small>
                            </ng-template>
                        </ng-select>
                    </div>
                    <div *ngIf="rFormSubbmitted && !rForm.get('farmDir').valid">
                        <small class="text-muted"><strong class="text-danger">Farmacistul trebuie introdus</strong>
                        </small>
                    </div>
                </div>
            </div>


            <hr>
            <!--=====================================================================================================================================-->
            <h5 class="text-center font-weight-bold">Obiectele adresarii</h5>
            <hr>
            <form [formGroup]="oForm">
                <div class="row">
                    <div class="col">
                        <div class="md-form">
                            <input id="tipIntreprindere" mdbInputDirective type="text" class="form-control"
                                   formControlName="tipIntreprindere">
                            <label for="tipIntreprindere">Tipul intreprinderii<span
                                    class="text-danger"> * </span></label>
                        </div>
                        <div *ngIf="oFormSubbmitted && !oForm.get('tipIntreprindere').valid">
                            <small class="text-muted"><strong class="text-danger">Tipul intreprinderii este
                                obligatoriu</strong></small>
                        </div>
                    </div>


                    <div class="col">
                        <div class="md-form-modified-select">
                            <ng-select class="custom" [items]="states"
                                       bindLabel="description"
                                       placeholder="Regiunea"
                                       formControlName="region"
                            >
                            </ng-select>
                        </div>
                        <div *ngIf="oFormSubbmitted && !oForm.get('region').valid">
                            <small class="text-muted"><strong class="text-danger">Regiunea este obligatorie</strong>
                            </small>
                        </div>
                    </div>
                    <div class="col">
                        <div class="md-form-modified-select">
                            <ng-select class="custom" [items]="localities"
                                       bindLabel="description"
                                       placeholder="Localitate"
                                       formControlName="locality"
                            >
                            </ng-select>
                        </div>
                        <div *ngIf="oFormSubbmitted && !oForm.get('locality').valid">
                            <small class="text-muted"><strong class="text-danger">Localitatea este obligatorie</strong>
                            </small>
                        </div>
                    </div>
                    <div class="col">
                        <div class="md-form">
                            <input id="street" mdbInputDirective type="text" class="form-control"
                                   formControlName="street">
                            <label for="street">Strada</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="md-form">
                            <input id="blocul" mdbInputDirective type="text" class="form-control"
                                   formControlName="blocul">
                            <label for="blocul">Blocul</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="text-center">
                            <div class="md-form">
                                <button type="button" class="btn btn-indigo waves-light btn-sm btn-sm-bl" mdbWavesEffect
                                        (click)="addNewObjAddres()" [disabled]="tipCerere === 'LICD'">Adauga
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <hr>
            <table class="table table-widths text-center">
                <thead class="black white-text">
                <tr>
                    <th scope="col">Tipul intreprinderii</th>
                    <th scope="col">Regiunea</th>
                    <th scope="col">Localitatea</th>
                    <th scope="col">Strada</th>
                    <th scope="col">Blocul</th>
                    <th scope="col">Actiuni</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let objAddr of objAddresses;let i = index">
                    <th scope="row">{{ objAddr.companyType }}</th>
                    <td>{{ objAddr.state.description }}</td>
                    <td>{{ objAddr.locality.description }}</td>
                    <td>{{ objAddr.street }}</td>
                    <td>{{ objAddr.building }}</td>
                    <td>
                        <button class="btn btn-dark-red-color waves-light btn-sm waves-light" type="button"
                                (click)="removeDocument(i)" mdbWavesEffect [disabled]="tipCerere === 'LICD'">Sterge
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
            <div *ngIf="rFormSubbmitted && objAddresses.length==0">
                <small class="text-muted"><strong class="text-danger">Nici un obiect nu a fost adaugat</strong></small>
            </div>
            <hr>


            <!--=====================================================================================================================================-->
            <h5 class="text-center font-weight-bold">Date generale</h5>
            <hr>
            <div class="row">

                <div class="col-md-4">
                    <div class="col">
                        <div class="md-form-modified-select">
                            <ng-select [items]="activities"
                                       bindLabel="description"
                                       placeholder="Tipuri de activitate"
                                       formControlName="licenseActivities"
                                       [multiple]="true"
                                       [required]="true"
                            >
                            </ng-select>
                        </div>
                        <div *ngIf="rFormSubbmitted && !rForm.get('licenseActivities').valid">
                            <small class="text-muted"><strong class="text-danger">Trebuie de ales cel putin un gen de
                                activitate</strong>
                            </small>
                        </div>
                    </div>
                </div>


                <div class="col-md-4">
                    <div class="md-form">
                        <input id="seriaLic" mdbInputDirective type="text" class="form-control"
                               formControlName="seriaLic">
                        <label for="seriaLic">Seria licenţei<span class="text-danger"> * </span></label>
                    </div>
                    <div *ngIf="rFormSubbmitted && !rForm.get('seriaLic').valid">
                        <small class="text-muted"><strong class="text-danger">Seria licentei trebuie introdusa</strong>
                        </small>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="md-form">
                        <input id="nrLic" mdbInputDirective type="text" class="form-control"
                               formControlName="nrLic">
                        <label for="nrLic">Numarul licenţei<span class="text-danger"> * </span></label>
                    </div>
                    <div *ngIf="rFormSubbmitted && !rForm.get('nrLic').valid">
                        <small class="text-muted"><strong class="text-danger">Numarul licentei trebuie introdus</strong>
                        </small>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="md-form">
                        <input id="mnrIntrareCPCD" mdbInputDirective type="text" class="form-control"
                               formControlName="CPCDNrdeintrare">
                        <label for="mnrIntrareCPCD">Nr. de intrare a răspunsului CPCD</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="md-form-modified">
                        <mat-form-field class="w-100">
                            <input matInput [matDatepicker]="picker7" placeholder="Data anunţării CPCD"
                                   formControlName="CPCDDate">
                            <mat-datepicker-toggle matSuffix [for]="picker7"></mat-datepicker-toggle>
                            <mat-datepicker touchUi #picker7></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col-3">
                    <div class="md-form-modified">
                        <ng-select [items]="announces"
                                   bindLabel="description"
                                   placeholder="Metoda"
                                   formControlName="CPCDMethod"

                        >
                        </ng-select>
                    </div>
                </div>
                <div class="col-md-3" *ngIf="!rForm.get('CPCDMethod').value">
                </div>
                <div class="col-md-3"
                     *ngIf="rForm.get('CPCDMethod').value && rForm.get('CPCDMethod').value.code === 'email'">
                    <div class="md-form">
                        <input id="email1" mdbInputDirective type="text" class="form-control"
                               formControlName="CPCDEmail">
                        <label for="email1">Email</label>
                    </div>
                </div>
                <div class="col-md-3"
                     *ngIf="rForm.get('CPCDMethod').value && rForm.get('CPCDMethod').value.code === 'phone'">
                    <div class="md-form">
                        <input id="telefon1" mdbInputDirective type="text" class="form-control"
                               formControlName="CPCDPhone">
                        <label for="telefon1">Telefon</label>
                    </div>
                </div>


                <div class="col-md-3">
                    <div class="md-form">
                        <input id="nrRasASP" mdbInputDirective type="text" class="form-control"
                               formControlName="ASPNrdeintrare">
                        <label for="nrRasASP">Nr. de intrare a răspunsului ASP</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="md-form-modified">
                        <mat-form-field class="w-100">
                            <input matInput [matDatepicker]="picker6" placeholder="Data anunţării ASP"
                                   formControlName="ASPDate">
                            <mat-datepicker-toggle matSuffix [for]="picker6"></mat-datepicker-toggle>
                            <mat-datepicker touchUi #picker6></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col-3">
                    <div class="md-form-modified">
                        <ng-select [items]="announces"
                                   bindLabel="description"
                                   placeholder="Metoda"
                                   formControlName="ASPMethod">
                        </ng-select>
                    </div>
                </div>
                <div class="col-md-3" *ngIf="!rForm.get('ASPMethod')">
                </div>
                <div class="col-md-3"
                     *ngIf="rForm.get('ASPMethod').value && rForm.get('ASPMethod').value.code === 'email'">
                    <div class="md-form">
                        <input id="email" mdbInputDirective type="text" class="form-control" formControlName="ASPEmail">
                        <label for="email">Email</label>
                    </div>
                </div>
                <div class="col-md-3"
                     *ngIf="rForm.get('ASPMethod').value && rForm.get('ASPMethod').value.code === 'phone'">
                    <div class="md-form">
                        <input id="telefon" mdbInputDirective type="text" class="form-control"
                               formControlName="ASPPhone">
                        <label for="telefon">Telefon</label>
                    </div>
                </div>


            </div>
            <hr>
            <h5 class="text-center font-weight-bold">Decizia</h5>
            <hr>
            <div class="row">
                <div class="offset-2 col-4 mt-6">
                    <div class="md-form-modified">

                        <mat-radio-group formControlName="decizieLuata">
                            <div class="container">
                                <div class="row">
                                    <!--<div class="offset-2"></div>-->
                                    <div class="col-12">
                                        <mat-radio-button name="prop1" value="1">Acceptare</mat-radio-button>
                                    </div>
                                    <div class="col-12">
                                        <mat-radio-button name="prop2" value="0">Refuz</mat-radio-button>
                                    </div>
                                    <!--<div class="offset-2"></div>-->
                                </div>
                                <div *ngIf="rFormSubbmitted && !rForm.get('decizieLuata').valid">
                                    <small class="text-muted"><strong class="text-danger">Decizia trebuie
                                        introdusa</strong>
                                    </small>
                                </div>
                            </div>
                        </mat-radio-group>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mt-2">
                        <div class="md-form-modified">
                            <mat-form-field class="w-100">
                                <input matInput [matDatepicker]="picker2" placeholder="Data deciziei"
                                       formControlName="decisionDate">
                                <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                                <mat-datepicker touchUi #picker2></mat-datepicker>
                            </mat-form-field>
                        </div>
                    </div>
                    <div *ngIf="rFormSubbmitted && !rForm.get('decisionDate').valid">
                        <small class="text-muted"><strong class="text-danger">Data deciziei trebuie introdusa</strong>
                        </small>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="md-form">
                        <textarea type="text" id="argumentDec" class="md-textarea form-control" mdbInputDirective rows="2" formControlName="argumentDec"></textarea>
                        <label for="argumentDec">Argumentarea deciziei</label>
                    </div>
                </div>
            </div>

            <!--<div class="row">-->
                <!-- <div class="col-md-3">
                     <div class="md-form">
                         <input id="decizieLuata" mdbInputDirective type="text" class="form-control"
                                formControlName="decizieLuata">
                         <label for="decizieLuata">Decizia luată <span class="text-danger"> * </span></label>
                     </div>
                     <div *ngIf="rFormSubbmitted && !rForm.get('decizieLuata').valid">
                         <small class="text-muted"><strong class="text-danger">Decizia trebuie introdusa</strong>
                         </small>
                     </div>
                 </div>-->

                <!--<div class="col-md-3">-->
                    <!--<div class="md-form">-->
                        <!--<input id="argumentDec" mdbInputDirective type="text" class="form-control"-->
                               <!--formControlName="argumentDec">-->
                        <!--<label for="argumentDec">Argumentarea deciziei</label>-->
                    <!--</div>-->
                <!--</div>-->

            <!--</div>-->

            <hr>


            <app-payment [receipts]="receiptsList" [paymentOrders]="paymentOrdersList"
                         (totalValueChanged)="paymentTotalUpdate($event)"></app-payment>
            <div *ngIf="rFormSubbmitted && nextSubmit && paymentTotal < 0">
                <small class="text-muted"><strong class="text-danger">Clientul are datorii.</strong></small>
            </div>
            <hr>

            <hr>
            <h5 class="text-center font-weight-bold">Documente de iesire</h5>
            <hr>

            <table class="table table-widths-lg text-center">
                <thead class="black white-text">
                <tr>
                    <th scope="col">Denumirea</th>
                    <th scope="col">Numar</th>
                    <th scope="col">Status document</th>
                    <th>Actiuni</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let a of outDocuments">
                    <th scope="row">{{ a.name }}</th>
                    <th scope="row">{{ a.number }}</th>
                    <th scope="row">{{ a.status ? a.status.description : ''}}</th>
                    <td>
                        <button class="btn btn-default btn-sm waves-light" mdbWavesEffect (click)="viewDoc(a)">Vizualizare</button>
                    </td>
                </tr>
                </tbody>
            </table>
            <div *ngIf="rFormSubbmitted && !checkAllDocumentsWasAttached()">
                <small class="text-muted"><strong class="text-danger">Exista documente care nu au fost atasate</strong></small>
            </div>


            <div class="text-center">
                <button type="button" (click)="submit()" class="btn btn-dark-green-color waves-light btn-sm btn-sm-bl"
                        mdbWavesEffect>Salvare date
                </button>
                <button type="button" (click)="submitNextStep()"
                        class="btn btn-dark-green-color waves-light btn-sm btn-sm-bl" mdbWavesEffect [disabled]="rForm.get('decizieLuata').value !== '1'" >Urmatorul pas
                </button>
                <button type="button" (click)="cancelRequest()"
                        class="btn btn-dark-green-color waves-light btn-sm btn-sm-bl" mdbWavesEffect [disabled]="rForm.get('decizieLuata').value !== '0'" > Intrerupere proces
                </button>
            </div>
        </section>
    </form>
</div>